id: "ddd_v2"
name: "DDD (Domain Driven Design)"
version: 2

definition:
  summary: >
    ドメイン知識を中心にユビキタス言語と境界づけられたコンテキストで
    モデルとコードを結び、組織とソフトウェアの進化を同期させる設計アプローチ。
  details: |
    DDD v2では、ドメインイベントや業務ルールを言語化し、コンテキスト境界で
    責務とデータの所有権を分割する。エンティティ/値オブジェクト/集約を適切に
    定義し、リポジトリやドメインサービスでユースケースを実装。コンテキスト間は
    契約(ACL、公開API、イベント)を明示し、組織のチーム構造と整合させる。継続的な
    モデルリファインメントとイベントストーミングを通じて、変化するビジネスに適応する。

usage_context:
  description: >
    サブドメインが複数存在し、用語や業務フローが部門で異なる大規模プロダクト、
    または複雑なビジネスルールを安全に進化させたい場合に適する。
  examples:
    - "決済・在庫・マーケティングを含むEC基幹の分割統治と再設計"
    - "SaaSで国ごとに異なる法規制・会計基準へ対応するマルチテナント構成"
    - "金融業で勘定・リスク計算・顧客接点を別コンテキストとして連携させるアーキテクチャ刷新"

decision_axes:
  - name: "ユビキタス言語の運用度"
    description: "用語辞書が維持され、ドキュメント・コード・会話で一貫して使われているか"
  - name: "コンテキスト境界の健全性"
    description: "責務が明確で、データ/トランザクションの境界が衝突なく定義されているか"
  - name: "協調パターンの適合性"
    description: "共有カーネル、コンフォーミスト、顧客/供給者などの関係が妥当か"
  - name: "モデルのコード反映度"
    description: "エンティティや集約がビジネス不変条件を守り、テストで意図が表現されているか"
  - name: "組織アラインメント"
    description: "チーム構造とコンテキスト分割が整合し、変更の独立性を保てているか"

primary_roles:
  - "domain_expert"
  - "product_owner"
  - "software_architect"
  - "backend_engineer"
  - "tech_lead"

anti_patterns:
  - name: "用語の多義化放置"
    description: "同じ用語がコンテキスト跨ぎで異なる意味のまま共有される"
  - name: "無計画な共有モデル化"
    description: "共有カーネルを乱立させ境界が曖昧になり、依存が雪だるま式に増える"
  - name: "データ中心の結合"
    description: "集約を越えて直接データを参照・更新し、整合性破綻を招く"
  - name: "イベント乱造"
    description: "意図のないドメインイベントを大量発行し、ノイズでモデル意図が薄まる"

evaluation:
  qualitative:
    guidelines: |
      - ドメインイベントや用語の意味が会話・コード・ドキュメントで一致しているか
      - コンテキスト間依存の発生理由が説明され、定期的に見直されているか
      - モデルの変更がビジネス戦略や組織変更と連動しているか
  quantitative:
    metrics:
      - name: "コンテキスト間カップリング数"
        description: "境界を越える同期/非同期依存の件数とトレンド"
      - name: "用語不整合指摘件数"
        description: "レビューやテストで発覚した言語衝突の件数"
      - name: "集約整合性違反数"
        description: "不変条件を破るバグの発生件数"
      - name: "独立デプロイ率"
        description: "単一コンテキストのみで完結するデプロイの割合"

examples:
  success_cases:
    - description: >
        EC基幹を決済・在庫・カタログで分離し、用語辞書と契約テストを整備。
        チームごとに独立デプロイが可能になり、変更リードタイムが半減した。
  failure_cases:
    - description: >
        共有データベースでモデルを一元化した結果、用語衝突と結合度が増大。
        小変更でも全システムリリースが必要になり、障害頻度が上がった。

relations:
  synergies:
    - "tdd"
    - "docdd"
    - "api_driven_design"
  conflicts:
    - "big_ball_of_mud"
    - "short_term_feature_hacking"
  notes: >
    コンテキストマップとイベントストーミングを定期更新し、組織設計と合わせて運用する。
